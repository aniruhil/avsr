---
title: "R Script for Chapter 3"
author: "ani"
date: "January 15, 2015"
output:
  html_document:
    fig_width: 8
    highlight: haddock
    keep_md: yes
---

### Describing Data: Central Tendency and Dispersion
Working with the data on gliding snakes' undulation rates we will calculate the mean, median, range, interquartile range, variance, and standard deviation. We will also construct some plots in order to see a few things in action. First we read in  the data-set.

```{r}
snakeData <- read.csv(url("http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter03/chap03e1GlidingSnakes.csv"))
head(snakeData)
```

Drawing a histogram of these data will allow us to see how undulation rates distributed. 
```{r}
hist(snakeData$undulationRateHz, right = FALSE, las = 1, col = "gray", breaks = seq(0.8,2.2,by=0.2), xlab = "Undulation rate (Hz)", ylab = "Frequency", main = "Distribution of Undulation Rates (in Hz)", ylim=c(0,3))
```

The code below does the same thing via <code>ggplot2</code>
```{r}
library(ggplot2)
ggplot(snakeData, aes(undulationRateHz)) + geom_histogram(binwidth=0.2)
```

Calculating the mean, median, variance, and standard deviation is pretty straightforward: 
```{r}
mean(snakeData$undulationRate)
median(snakeData$undulationRate)
var(snakeData$undulationRate)
sd(snakeData$undulationRate)
```

**Note:** If you have missing values in your data-set then you should run <code>mean(snakeData$undulationRateHz, na.rm=TRUE)</code>, etc. for all commands. As a matter of fact R has several commands that will not run unless you specify <code>na.rm=TRUE</code>

Note also that the Mean $(=1.375)$ is greater than the Median $(1.350)$; Why do you think this is the case?


We have to be a bit careful when calculating the quartiles $(i.e., Q_1, Q_3)$ and the interquartile range. This is because there are nine ways of calculating these. If you are curious about these methods type and run <code>help(quantile)</code) but note that we will use <code>type=5</code> in this class since that is what is used by Whitlock & Schluter. The relevant commands are shown below:
```{r}
quantile(snakeData$undulationRateHz, probs=c(0.25, 0.75), type=5)
IQR(snakeData$undulationRateHz, type=5)
```

**Note:** $IQR = Q_3 - Q_1 = 1.5 - 1.2 = 0.3$ 


The Coefficient of Variation tells us something about how a variable is distributed about its mean. Given that it is a ratio, the higher is the coefficient of variation the more dispersed are the values of the variable. Why is it a useful measure if we have others to choose from? Because it is not influenced by the units of measurement. For example, if you are measuring heights in inches and calculate the variance and standard deviation, then convert height into centimeters and recompute the variance and standard deviation, the two sets of values will differ a good bit (see below):
```{r}
height.in <- c(65, 72, 77, 60, 58)
mean(height.in)
sd(height.in)
height.cm <- height.in * 2.54
mean(height.cm)
sd(height.cm)
```

Now suddenly it seems as if there is more variability when height is measured in centimeters, but this is because of the units of measurement being used! If we now calculate the coefficient of variation for height in inches and then for height in centimeters we get identical estimates of how much variation there is in the heights of these individuals:
```{r}
cov.in <- (sd(height.in) / mean(height.in)) * 100
cov.in
cov.cm <- (sd(height.cm) / mean(height.cm)) * 100
cov.cm
```

Now calculating the coefficient of variation for the gliding snakes data-set:
```{r}
100 * sd(snakeData$undulationRate)/mean(snakeData$undulationRate)
```

### Working with Grouped Data
For this exercise we'll replicate the in-text example that uses the number of convictions data-set (see below):
```{r}
convictionsFreq <- read.csv(url("http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter03/chap03t1_2ConvictionsFreq.csv"))
head(convictionsFreq)
```

Notice the format of the data ... it is given to us as a frequency table. Not a problem so long as we understand what we are looking at. In brief, 265 boys had no convictions, 49 had 1 conviction, and so on. We can expand the data into its long (or raw form as shown below:
```{r}
convictions <- rep(convictionsFreq$convictions, convictionsFreq$frequency)
head(convictions)
```

Now the calculations can commence:
```{r}
mean(convictions)
median(convictions)
sd(convictions)
var(convictions)
quantile(convictions, probs=c(0.25, 0.75), type=5)
IQR(convictions, type=5)
( sd(convictions) / mean(convictions) ) * 100
tab.c <- table(convictions); tab.c
barplot(tab.c, ylim=c(0,300), xlab="Number of Convictions", ylab="Frequency")
```

#### The Speeds of male Tidarren spiders (pre- and post-amputation)
```{r}
spiderData <- read.csv(url("http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter03/chap03e2SpiderAmputation.csv"))
head(spiderData)
```

**Note:** The two variables of interest are <code>speed</code> and <code>treatment</code>. We can start by constructing histograms of speeds before and after amputation. We will then look at a different graphic ... the <code>boxplot</code>, an extremely useful plot because it conveys a lot of information very simply. First the histograms
```{r}
library(lattice)
histogram(~ speed | treatment, data=spiderData, layout=c(1,2), type=c("count"))
```

Now the box-plots:
```{r}
boxplot(speed ~ treatment, data=spiderData, horizontal=TRUE, ylab="Amputation Treatment", xlab="Speed (cm/s)", col="gray")
```

For each group the boxplot maps a few statistics. First, the dark line inside each box is the Median for the group. Clearly the median speed is higher for the post-amputation group than for the pre-amputation group. The edges of the gray boxes reflect the first and third quartiles for each group; $Q_1$ is to the left of the Median and $Q_3$ is to the right of the Median. The "whiskers" go out to the minimum and maximum values. 

If a distribution is symmetric then the box should be equally wide either side of the Median and the whiskers should be of similar length on either side of the box. If you see the plot looking stretched out on one side then that tells us it is skewed towards this side. For instance, see the stretch to the right for the "after"" group; these data are positively skewed (aka skewed right). For the "before" group we see the stretch to the left; this group's speeds are negatively skewed (i.e. skewed left). 

We also see a lone dot at the lower extreme of the plot for the "before" group. This is an **outlier** ... any data point that is smaller than $Q_1 - (1.5 \times IQR)$ or larger than $Q_3 + (1.5 \times IQR)$. An outlier is essentially an extremely unusual value. 

We will now extract and save the before-amputation data using the <code>subset</code> switch. We will then repeat this exercise for the after-amputation data. 
```{r}
speedBefore <- subset(spiderData, treatment == "before") 
speedBefore
speedAfter <- subset(spiderData, treatment == "after") 
speedAfter
```

Now we can calculate the mean, median, variance, standard deviation, quartiles, and the interquartile range for each group. 
```{r}
mean(speedBefore$speed); mean(speedAfter$speed)
median(speedBefore$speed); median(speedAfter$speed)
var(speedBefore$speed); var(speedAfter$speed)
sd(speedBefore$speed); sd(speedAfter$speed)
quantile(speedBefore$speed, probs=c(0.25, 0.75), type=5)
quantile(speedAfter$speed, probs=c(0.25, 0.75), type=5)
IQR(speedBefore$speed, type=5)
IQR(speedAfter$speed, type=5)
```

Just for completeness' sake, multiply the IQR of each group by 1.5 
```{r}
1.5 * IQR(speedBefore$speed, type=5)
1.5 * IQR(speedAfter$speed, type=5)
```

Now subtract 1.0575 from $Q_1$ of the "before" group
```{r}
2.340 - 1.0575
```

This yields a value of $1.2825$ ... Spider #1 in the "before" group has a speed of $1.25$ and hence is flagged as an outlier in the boxplot. 


### Cumulative Frequency Distributions 
```{r}
par(mfrow=c(1,2))
plot( ecdf(speedBefore$speed), verticals = TRUE,  
  las = 1, main = "", do.points = FALSE,
	ylab = "Cumulative relative frequency", 
	xlab = "Running speed before amputation (cm/s)")
plot( ecdf(speedAfter$speed), verticals = TRUE,  
  las = 1, main = "", do.points = FALSE,
	ylab = "Cumulative relative frequency", 
	xlab = "Running speed after amputation (cm/s)" )
dev.off()
par(mfrow=c(1,1))
```

You can pick any point on the vertical axis, connect a straight line to the plotted line, then drop a perpendicular to the x-axis ... and you'll be able to say "so-and-so proportion of the spider had speeds below the x-value". Out of sheer curiosity, pick $0.5$ on the vertical axis of both groups and draw the straight line to the plot. Now read the approximate running speed that would result if you dropped a perpendicular to the x-axis. What this says is that 50% of spiders in the before group had speeds of at most 2.9 while 50% of spiders in the after group had speeds of at most 3.51.   
```{r}
par(mfrow=c(1,2))
plot( ecdf(speedBefore$speed), verticals = TRUE,  
  las = 1, main = "", do.points = FALSE,
  ylab = "Cumulative relative frequency", 
	xlab = "Running speed before amputation (cm/s)")
abline(h=0.5)
plot( ecdf(speedAfter$speed), verticals = TRUE,  
  las = 1, main = "", do.points = FALSE,
	ylab = "Cumulative relative frequency", 
	xlab = "Running speed after amputation (cm/s)" )
abline(h=0.5)
dev.off()
par(mfrow=c(1,1))
```

You don't have to pick the $0.5$ point; you could have picked $0.9$ and said "90% of spiders in group so-and-so had speeds of so much or less", so on and so forth.


### What if I have Three or More Groups?
The <code>psych</code> package (install it before you use it) is very handy here to calculate a number of statistics. We will see it in use with the data-set on sticklebacks:
```{r}
sticklebackData <- read.csv(url("http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter03/chap03e3SticklebackPlates.csv"))
head(sticklebackData)
library(psych)
describeBy(sticklebackData$plates, group=sticklebackData$genotype)
```

Histograms are easily drawn as well:
```{r}
histogram(~ plates | genotype, data=sticklebackData, layout=c(1,3), type="count", xlab="Number of Plates", ylab="Frequency")
```

Again, in a very marked fashion the $MM$ group has the most number of plates on average. 

Constructing a table of frequencies and proportions of the stickleback genotypes is easy as well. 
```{r}
tab.s1 <- table(sticklebackData$genotype, dnn = "genotype")
tab.s1
tab.s2 <- addmargins(tab.s1)
tab.s2
sticklebackFreq <- data.frame(tab.s2)
sticklebackFreq
tab.sprop1 <- prop.table(tab.s1)
tab.sprop1
tab.sprop2 <- addmargins(tab.sprop1)
sticklebackRelFreq <- data.frame(tab.sprop2)
sticklebackRelFreq
```
